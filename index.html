<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BioHands — Prototype LMS</title>
  <style>
    /* ====== Reset & Base ====== */
    :root{
      --primary:#2e8b57; /* vert */
      --accent:#0b76d1;  /* bleu */
      --muted:#6b7280;
      --bg:#f5f7fb;
      --card:#ffffff;
      --danger:#e53e3e;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family: "Cairo", "Poppins", system-ui, sans-serif;background:var(--bg);color:#111;}
    a{color:inherit;text-decoration:none}
    button{font-family:inherit}
    /* ====== Layout ====== */
    .app{display:flex;min-height:100vh;flex-direction:column}
    header.app-header{
      background: linear-gradient(90deg,var(--accent),#2aa3d6);
      color:white;padding:18px 20px;display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    header .brand{display:flex;align-items:center;gap:12px}
    header h1{font-size:1.25rem;margin:0}
    header .controls{display:flex;gap:8px;align-items:center}

    main.container{flex:1;padding:20px;max-width:1200px;margin:0 auto;width:100%;}
    .layout{display:flex;gap:20px}
    nav.sidebar{width:260px;min-width:220px;background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(11,37,71,0.06)}
    nav.sidebar h3{margin:0 0 12px 0;font-size:0.95rem;color:var(--muted);}
    nav.sidebar ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:6px}
    nav.sidebar li{display:block}
    nav.sidebar button.item{
      width:100%;text-align:right;padding:10px;border-radius:8px;border:0;background:transparent;color:#123;
      display:flex;justify-content:space-between;align-items:center;gap:8px;cursor:pointer;
    }
    nav.sidebar button.item[aria-current="true"]{background:linear-gradient(90deg, rgba(11,118,209,0.08), rgba(46,139,87,0.06));}

    section.content{flex:1}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 4px 14px rgba(10,20,40,0.04);margin-bottom:16px}
    .row{display:flex;gap:16px;flex-wrap:wrap}
    .col{flex:1;min-width:220px}

    /* Dashboard cards */
    .small-card{padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#f8fbff);display:flex;flex-direction:column;gap:8px}
    .progress-bar{height:10px;background:#eee;border-radius:999px;overflow:hidden}
    .progress-bar > i{display:block;height:100%;background:linear-gradient(90deg,var(--primary),var(--accent));width:0%}

    /* course list */
    .course-card{display:flex;justify-content:space-between;padding:12px;border-radius:10px;border:1px solid #eef3f6;align-items:center}
    .course-meta{display:flex;flex-direction:column;gap:6px;text-align:right}
    .chip{display:inline-block;background:#eef7f0;color:var(--primary);padding:6px 8px;border-radius:999px;font-size:0.85rem}

    /* video area */
    .player{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
    video{max-width:640px;width:100%;border-radius:8px;background:#000}
    .transcript{flex:1;min-width:220px;max-height:320px;overflow:auto;padding:10px;border-radius:8px;background:#fafafa;border:1px solid #f0f0f0}

    /* forms */
    .form-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
    label{display:block;font-size:0.95rem;margin-bottom:6px}
    input[type="text"], input[type="email"], input[type="password"], select, textarea{
      width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef5;background:white;font-size:0.95rem
    }
    .btn{padding:10px 14px;border-radius:8px;border:0;background:var(--primary);color:white;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid var(--primary);color:var(--primary)}
    .muted{color:var(--muted);font-size:0.95rem}

    /* responsive */
    @media (max-width:880px){
      .layout{flex-direction:column}
      nav.sidebar{width:100%;display:flex;overflow:auto;flex-direction:row;padding:8px;gap:8px}
      nav.sidebar ul{flex-direction:row}
      nav.sidebar button.item{min-width:120px;padding:8px}
    }

    /* accessibility focus */
    button:focus, a:focus, input:focus {outline:3px solid rgba(11,118,209,0.15);outline-offset:2px}

    /* small utilities */
    .right{text-align:right}
    .left{text-align:left}
    .hidden{display:none}
    .tag{font-size:0.82rem;padding:6px;border-radius:6px;background:#f3f7fb;color:#0b76d1}
    footer.footer{padding:18px;text-align:center;color:var(--muted);font-size:0.95rem}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header class="app-header" role="banner">
      <div class="brand" aria-hidden="false">
        <div style="width:44px;height:44px;border-radius:10px;background:white;display:flex;align-items:center;justify-content:center;color:var(--accent);font-weight:700">BH</div>
        <div>
          <h1 id="brandTitle">BioHands</h1>
          <div id="brandSlogan" class="muted">Science in every hand — العلم بلغة يفهمها الجميع</div>
        </div>
      </div>

      <div class="controls" role="navigation" aria-label="top controls">
        <select id="langSelect" aria-label="Select language">
          <option value="ar">العربية</option>
          <option value="fr">Français</option>
          <option value="en">English</option>
        </select>
        <button id="toggleContrast" title="High contrast" aria-pressed="false" class="btn secondary">Contrast</button>
        <div id="userArea"></div>
      </div>
    </header>

    <main class="container" role="main">
      <div class="layout">
        <nav class="sidebar" aria-label="Main navigation">
          <h3 id="navTitle">القائمة</h3>
          <ul id="menuList">
            <li><button class="item" data-page="dashboard" aria-current="true"><span class="right">لوحة التحكم</span><span class="tag">Dashboard</span></button></li>
            <li><button class="item" data-page="courses"><span class="right">الدورات</span><span class="tag">Courses</span></button></li>
            <li><button class="item" data-page="library"><span class="right">المكتبة</span><span class="tag">Library</span></button></li>
            <li><button class="item" data-page="progress"><span class="right">التقارير والتقدّم</span><span class="tag">Progress</span></button></li>
            <li><button class="item" data-page="support"><span class="right">الدعم</span><span class="tag">Support</span></button></li>
            <li><button class="item" data-page="settings"><span class="right">الإعدادات</span><span class="tag">Settings</span></button></li>
            <li><button class="item" data-page="logout" id="logoutBtn"><span class="right">تسجيل الخروج</span><span class="tag">Logout</span></button></li>
          </ul>
        </nav>

        <section class="content" id="contentArea" aria-live="polite">
          <!-- Pages injected here -->
        </section>
      </div>

      <footer class="footer">
        <div id="footerText">© 2025 BioHands — Inclusion × Education</div>
      </footer>
    </main>
  </div>

  <script>
    /*************************************************************************
     * Prototype LMS Single File
     * - Storage: localStorage (users, courses, progress)
     * - Language: ar/fr/en
     * - Role-based dashboard: student/teacher/admin
     *************************************************************************/

    /* ---------------- Data: sample courses & users ---------------- */
    const SAMPLE = {
      users: [
        // default demo users
        {id:1, email:"student@biohands.test", password:"student", name:"Ali", role:"student", lang:"ar"},
        {id:2, email:"teacher@biohands.test", password:"teacher", name:"Mme Leila", role:"teacher", lang:"fr"},
        {id:3, email:"admin@biohands.test", password:"admin", name:"Admin", role:"admin", lang:"en"}
      ],
      courses: [
        {
          id: 1,
          title_ar: "الفيزياء: الطاقة والحركة",
          title_fr: "Physique: Énergie et mouvement",
          title_en: "Physics: Energy & Motion",
          description_ar: "محتوى مبسّط مع شروحات بلغة الإشارة وتجارب تفاعلية.",
          description_fr: "Contenu simplifié avec vidéos en langue des signes et simulations.",
          description_en: "Simplified content with sign-language videos and simulations.",
          is_accessible_for_deaf: true,
          units: [
            { id:101, title_ar:"الوحدة 1: الطاقة", title_fr:"Unité 1: Énergie", title_en:"Unit 1: Energy",
              video: "", transcript_ar:"نص الدرس بالعربية...", transcript_fr:"Texte FR...", transcript_en:"Lesson text EN..." },
            { id:102, title_ar:"الوحدة 2: الحركة", title_fr:"Unité 2: Mouvement", title_en:"Unit 2: Motion",
              video: "", transcript_ar:"نص الدرس 2...", transcript_fr:"Texte FR 2...", transcript_en:"Lesson text EN 2..." }
          ]
        },
        {
          id: 2,
          title_ar: "الكيمياء: المواد والتغيّر", title_fr:"Chimie: Matières et changements", title_en:"Chemistry: Matter & Change",
          description_ar: "مقدمة لأساسيات الكيمياء مع مصطلحات بلغة الإشارة.",
          description_fr: "Introduction aux bases de la chimie avec glossaire en langue des signes.",
          description_en: "Intro to chemistry basics with sign language glossary.",
          is_accessible_for_deaf: true,
          units: [
            { id:201, title_ar:"الوحدة 1: الذرة", title_fr:"Unité 1: Atome", title_en:"Unit 1: Atom",
              video: "", transcript_ar:"نص الذرة...", transcript_fr:"Texte Atome...", transcript_en:"Atom text..." }
          ]
        }
      ]
    };

    /* ---------------- Utilities & i18n ---------------- */
    const LANG = { current: localStorage.getItem('bio_lang') || 'ar' };
    const strings = {
      ar: {
        loginTitle: "تسجيل الدخول",
        email: "البريد الإلكتروني",
        password: "كلمة المرور",
        forgot: "هل نسيت كلمة المرور؟",
        register: "تسجيل جديد بلغة الإشارة",
        welcome: "مرحبا",
        dashboard: "لوحة التحكم",
        startNext: "ابدأ الوحدة التالية",
        notifications: "الإشعارات",
        suggested: "أنشطة مقترحة",
        courses: "الدورات",
        enter: "ادخل",
        courseState: { ongoing:"جارية", not_started:"لم تبدأ", completed:"مكتملة" },
        library: "المكتبة",
        progress: "التقارير والتقدّم",
        support: "الدعم",
        settings: "الإعدادات",
        logout: "تسجيل الخروج",
        team: "فريقنا",
        noData: "لا توجد بيانات",
        startQuiz: "ابدأ الاختبار السريع",
        download: "تحميل نسخة مضغوطة",
        transcript: "نص الدرس",
        playSign: "مشاهدة بلغة الإشارة",
      },
      fr: {
        loginTitle: "Connexion",
        email: "E-mail",
        password: "Mot de passe",
        forgot: "Mot de passe oublié ?",
        register: "Inscription (langue des signes)",
        welcome: "Bienvenue",
        dashboard: "Tableau de bord",
        startNext: "Commencer l'unité suivante",
        notifications: "Notifications",
        suggested: "Activités suggérées",
        courses: "Cours",
        enter: "Entrer",
        courseState: { ongoing:"En cours", not_started:"Pas commencé", completed:"Terminé" },
        library: "Bibliothèque",
        progress: "Rapports & progrès",
        support: "Support",
        settings: "Paramètres",
        logout: "Se déconnecter",
        team: "Notre équipe",
        noData: "Aucune donnée",
        startQuiz: "Commencer le quiz",
        download: "Télécharger version compressée",
        transcript: "Transcription",
        playSign: "Voir en langue des signes",
      },
      en: {
        loginTitle: "Login",
        email: "Email",
        password: "Password",
        forgot: "Forgot password?",
        register: "Sign-up (sign language)",
        welcome: "Welcome",
        dashboard: "Dashboard",
        startNext: "Start next unit",
        notifications: "Notifications",
        suggested: "Suggested activities",
        courses: "Courses",
        enter: "Enter",
        courseState: { ongoing:"Ongoing", not_started:"Not started", completed:"Completed" },
        library: "Library",
        progress: "Reports & Progress",
        support: "Support",
        settings: "Settings",
        logout: "Logout",
        team: "Our team",
        noData: "No data",
        startQuiz: "Start quick quiz",
        download: "Download compressed version",
        transcript: "Transcript",
        playSign: "Watch in sign language",
      }
    };

    function t(key){
      const seg = key.split('.');
      let s = strings[LANG.current];
      for(const p of seg){
        if(!s) return key;
        s = s[p] || s[p];
      }
      return s || key;
    }

    /* ---------------- Storage helpers ---------------- */
    function loadData(){
      if(!localStorage.getItem('bio_users')){
        localStorage.setItem('bio_users', JSON.stringify(SAMPLE.users));
      }
      if(!localStorage.getItem('bio_courses')){
        localStorage.setItem('bio_courses', JSON.stringify(SAMPLE.courses));
      }
      if(!localStorage.getItem('bio_progress')){
        localStorage.setItem('bio_progress', JSON.stringify([]));
      }
    }
    function getUsers(){ return JSON.parse(localStorage.getItem('bio_users')||'[]') }
    function getCourses(){ return JSON.parse(localStorage.getItem('bio_courses')||'[]') }
    function getProgress(){ return JSON.parse(localStorage.getItem('bio_progress')||'[]') }
    function saveUsers(u){ localStorage.setItem('bio_users', JSON.stringify(u)) }
    function saveCourses(c){ localStorage.setItem('bio_courses', JSON.stringify(c)) }
    function saveProgress(p){ localStorage.setItem('bio_progress', JSON.stringify(p)) }

    /* ---------------- App state ---------------- */
    const AppState = { currentPage:'login', currentUser:null, currentCourseId:null, currentUnitId:null };

    /* ---------------- Render utilities ---------------- */
    const el = id => document.getElementById(id);
    function setContent(html){ el('contentArea').innerHTML = html }

    /* ---------------- Page: Login / Register (simulé) ---------------- */
    function pageLogin(){
      LANG.current = localStorage.getItem('bio_lang') || LANG.current;
      const s = t;
      setContent(`
        <section class="card" aria-labelledby="loginTitle">
          <h2 id="loginTitle">${s('loginTitle')}</h2>
          <div style="max-width:520px;margin-top:12px;">
            <div class="form-row">
              <label>${s('email')}</label>
              <input id="inpEmail" type="email" placeholder="${s('email')}" />
            </div>
            <div class="form-row">
              <label>${s('password')}</label>
              <input id="inpPassword" type="password" placeholder="${s('password')}" />
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <button id="btnLogin" class="btn">${s('loginTitle')}</button>
              <button id="btnRegister" class="btn secondary">${s('register')}</button>
              <div class="muted" style="margin-left:auto">${s('forgot')}</div>
            </div>
            <div style="margin-top:12px" class="muted">Demo users: student@biohands.test / student , teacher@... / teacher , admin@... / admin</div>
          </div>
        </section>
      `);

      el('btnLogin').addEventListener('click', ()=>{
        const email = el('inpEmail').value.trim();
        const pass = el('inpPassword').value.trim();
        const users = getUsers();
        const user = users.find(u=>u.email===email && u.password===pass);
        if(user){
          AppState.currentUser = user;
          localStorage.setItem('bio_current_user', JSON.stringify(user));
          navigateTo('dashboard');
          renderTopUser();
        } else {
          alert({ar:'بيانات غير صحيحة',fr:'Identifiants invalides',en:'Invalid credentials'}[LANG.current] || 'Invalid credentials');
        }
      });

      el('btnRegister').addEventListener('click', ()=>{
        // Simulated register: open form modal inline
        openRegisterInline();
      });
    }

    function openRegisterInline(){
      setContent(`
        <section class="card">
          <h2>${t('register')}</h2>
          <div style="max-width:600px">
            <div class="form-row"><label>${t('email')}</label><input id="regEmail" type="email" /></div>
            <div class="form-row"><label>${t('password')}</label><input id="regPass" type="password" /></div>
            <div class="form-row"><label>الاسم / Name</label><input id="regName" type="text" /></div>
            <div class="form-row"><label>Role</label>
              <select id="regRole"><option value="student">Student/طالب</option><option value="teacher">Teacher/معلم</option><option value="admin">Admin/إداري</option></select>
            </div>
            <div style="display:flex;gap:8px">
              <button id="regDo" class="btn">سجّل / Register</button>
              <button id="regBack" class="btn secondary">عودة</button>
            </div>
          </div>
        </section>
      `);
      el('regBack').addEventListener('click', pageLogin);
      el('regDo').addEventListener('click', ()=>{
        const email = el('regEmail').value.trim();
        const pass = el('regPass').value.trim();
        const name = el('regName').value.trim() || 'User';
        const role = el('regRole').value;
        if(!email || !pass){ alert('Please fill'); return; }
        const users = getUsers();
        if(users.find(u=>u.email===email)){ alert('Email exists'); return; }
        const id = Date.now();
        const user = {id, email, password:pass, name, role, lang:LANG.current};
        users.push(user); saveUsers(users);
        alert('Registered! Use login now.');
        pageLogin();
      });
    }

    /* ---------------- Render Top user area & actions ---------------- */
    function renderTopUser(){
      const container = el('userArea');
      container.innerHTML = '';
      const user = AppState.currentUser || JSON.parse(localStorage.getItem('bio_current_user') || 'null');
      if(!user){
        const btn = document.createElement('button'); btn.className='btn'; btn.innerText = t('loginTitle');
        btn.addEventListener('click', ()=>{ navigateTo('login'); });
        container.appendChild(btn);
      } else {
        const div = document.createElement('div'); div.style.display='flex';div.style.gap='8px';div.style.alignItems='center';
        const nameSpan = document.createElement('span'); nameSpan.innerText = `${user.name} (${user.role})`;
        const menuBtn = document.createElement('button'); menuBtn.className='btn secondary'; menuBtn.innerText = t('logout');
        menuBtn.addEventListener('click', ()=>{ logout(); });
        div.appendChild(nameSpan); div.appendChild(menuBtn);
        container.appendChild(div);
      }
    }

    function logout(){
      localStorage.removeItem('bio_current_user');
      AppState.currentUser = null;
      navigateTo('login');
      renderTopUser();
    }

    /* ---------------- Navigation ---------------- */
    function setActiveMenu(page){
      document.querySelectorAll('#menuList .item').forEach(b=>{
        b.setAttribute('aria-current', b.dataset.page===page ? 'true' : 'false');
      });
    }
    function navigateTo(page, opts={}){
      AppState.currentPage = page;
      setActiveMenu(page);
      if(page==='login'){ pageLogin(); document.title='BioHands - Login' }
      else if(page==='dashboard'){ pageDashboard() }
      else if(page==='courses'){ pageCourses() }
      else if(page==='courseUnit'){ pageCourseUnit(opts.courseId, opts.unitId) }
      else if(page==='library'){ pageLibrary() }
      else if(page==='progress'){ pageProgress() }
      else if(page==='support'){ pageSupport() }
      else if(page==='settings'){ pageSettings() }
      else pageDashboard();
      // update header texts depending on language
      updateStaticTexts();
    }

    document.querySelectorAll('#menuList .item').forEach(b=>{
      b.addEventListener('click', (ev)=>{
        const p = b.dataset.page;
        if(p==='logout'){ logout(); return; }
        navigateTo(p);
      });
    });

    /* ---------------- Page: Dashboard (role-specific) ---------------- */
    function pageDashboard(){
      const user = AppState.currentUser || JSON.parse(localStorage.getItem('bio_current_user') || 'null');
      const courses = getCourses();
      const progress = getProgress();
      // compute user progress per course
      const courseCards = courses.map(c=>{
        // compute percent by units completed
        const total = c.units.length;
        const completed = c.units.filter(u=>progress.find(p=>p.userId===user?.id && p.unitId===u.id && p.status==='completed')).length;
        const percent = Math.round((completed/Math.max(1,total))*100);
        return {id:c.id, title:getLocalized(c,'title'), desc:getLocalized(c,'description'), percent};
      });

      let mainHtml = `<section class="card"><h2>${t('dashboard')}</h2>`;
      mainHtml += `<div class="row" style="margin-top:12px">`;

      // welcome & quick actions
      mainHtml += `<div class="col card small-card" style="min-width:260px">
        <div><strong>${t('welcome')}${user?(', '+user.name):''}</strong></div>
        <div class="muted" style="font-size:0.95rem;margin-top:6px">${t('notifications')}: <span id="notifCount">0</span></div>
        <div style="margin-top:10px">
          <button class="btn" id="btnStartNext">${t('startNext')}</button>
        </div>
      </div>`;

      // courses progress small cards
      mainHtml += `<div class="col" style="min-width:340px"><div class="row">`;
      courseCards.forEach(c=>{
        mainHtml += `<div class="col small-card" style="min-width:180px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="text-align:right">
              <div style="font-weight:700">${escapeHtml(c.title)}</div>
              <div class="muted" style="font-size:0.9rem">${escapeHtml(c.desc)}</div>
            </div>
            <div style="width:120px;text-align:left">
              <div class="progress-bar" aria-hidden="true"><i style="width:${c.percent}%"></i></div>
              <div class="muted" style="font-size:0.85rem;margin-top:6px;text-align:left">${c.percent}%</div>
            </div>
          </div>
        </div>`;
      });
      mainHtml += `</div></div>`;

      // suggested activities
      mainHtml += `<div class="col small-card" style="min-width:220px"><strong>${t('suggested')}</strong>
        <div class="muted" style="margin-top:8px">تجربة تفاعلية: دائرة كهربائية بسيطة</div>
        <div style="margin-top:10px"><button class="btn secondary" id="btnSuggested">ابدأ</button></div>
      </div>`;

      mainHtml += `</div></section>`;

      setContent(mainHtml);

      // bind actions
      el('btnStartNext')?.addEventListener('click', ()=>{
        // find first not completed unit of first course
        const courses = getCourses();
        const pr = getProgress();
        const userId = AppState.currentUser?.id || null;
        if(!userId){ alert('Please login'); return; }
        for(const c of courses){
          for(const u of c.units){
            const p = pr.find(pp=>pp.userId===userId && pp.unitId===u.id);
            if(!p || p.status!=='completed'){
              // navigate to unit
              navigateTo('courseUnit',{courseId:c.id, unitId:u.id});
              return;
            }
          }
        }
        alert('All done!');
      });

      el('btnSuggested')?.addEventListener('click', ()=>{ alert('Simulation demo: not implemented in prototype') });
    }

    /* ---------------- Page: Courses list ---------------- */
    function pageCourses(){
      const courses = getCourses();
      let html = `<section class="card"><h2>${t('courses')}</h2>`;
      if(courses.length===0){ html += `<div class="muted">${t('noData')}</div>`;}
      else {
        html += `<div style="margin-top:12px;display:flex;flex-direction:column;gap:10px">`;
        courses.forEach(c=>{
          html += `<div class="course-card" role="article" aria-labelledby="course-${c.id}">
            <div class="course-meta">
              <div id="course-${c.id}" style="font-weight:700">${escapeHtml(getLocalized(c,'title'))}</div>
              <div class="muted">${escapeHtml(getLocalized(c,'description'))}</div>
            </div>
            <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-start">
              <div class="chip">${c.is_accessible_for_deaf ? '✓' : ''} ${LANG.current==='ar'?'مخصص للصم':'Accessible'}</div>
              <div>
                <button class="btn" onclick="prototypeEnterCourse(${c.id})">${t('enter')}</button>
              </div>
            </div>
          </div>`;
        });
        html += `</div>`;
      }
      html += `</section>`;
      setContent(html);
    }

    window.prototypeEnterCourse = function(courseId){
      const course = getCourses().find(c=>c.id===courseId);
      if(!course){ alert('Course not found'); return; }
      // open first unit or course overview
      const unit = course.units[0];
      navigateTo('courseUnit',{courseId, unitId: unit.id});
    };

    /* ---------------- Page: Course Unit (video + transcript + actions) ---------------- */
    function pageCourseUnit(courseId, unitId){
      const courses = getCourses();
      const course = courses.find(c=>c.id===courseId);
      if(!course){ setContent('<div class="card">Course not found</div>'); return; }
      const unit = course.units.find(u=>u.id===unitId);
      if(!unit){ setContent('<div class="card">Unit not found</div>'); return; }

      // build UI with video placeholder, captions, transcript
      const title = getLocalized(unit,'title');
      const transcript = getLocalized(unit,'transcript') || t('noData');

      let html = `<section class="card"><h2>${escapeHtml(title)}</h2>
        <div class="player" style="margin-top:12px">
          <div style="flex:1">
            <!-- Video placeholder -->
            <video id="lessonVideo" controls aria-label="${t('playSign')}" preload="metadata">
              <!-- In a real app, src would be a recorded lecture in sign language -->
              <!-- No src provided in prototype; user can attach via settings or uploader -->
              <source src="" type="video/mp4">
              ${LANG.current==='ar' ? 'فيديو غير متوفر في النموذج' : 'No video available in prototype'}
            </video>
            <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
              <button class="btn" id="btnStartExp">${t('startNext')}</button>
              <button class="btn secondary" id="btnDownload">${t('download')}</button>
              <button class="btn secondary" id="btnRecord">${LANG.current==='ar'?'سجل فيديو شرحك':'Record explanation'}</button>
            </div>
          </div>

          <aside class="transcript" aria-label="${t('transcript')}">
            <h3>${t('transcript')}</h3>
            <pre id="transcriptText" style="white-space:pre-wrap">${escapeHtml(transcript)}</pre>
          </aside>
        </div>

        <div style="margin-top:12px" class="row">
          <div class="col card">
            <h4>الدروس الفرعية / Sub-lessons</h4>
            <ul>
              ${course.units.map(u=>`<li style="margin-bottom:6px">${escapeHtml(getLocalized(u,'title'))} <button class="btn secondary" onclick="navigateTo('courseUnit',{courseId:${courseId},unitId:${u.id}})">${t('enter')}</button></li>`).join('')}
            </ul>
          </div>

          <div class="col card">
            <h4>${t('startQuiz')}</h4>
            <p class="muted">اختبار قصير يقيس الفهم (محاكاة)</p>
            <button class="btn" id="btnDoQuiz">${t('startQuiz')}</button>
          </div>
        </div>
      </section>`;

      setContent(html);

      // mark progress on "complete" when user clicks download or quiz completion
      document.getElementById('btnDownload').addEventListener('click', ()=>{
        // simulate completing unit (100%)
        updateProgressForUnit(unit.id, 100, 'completed');
        alert(LANG.current==='ar'?'تم حفظ التقدم!':'Progress saved!');
      });

      document.getElementById('btnDoQuiz').addEventListener('click', async ()=>{
        // simple quiz simulation
        const ok = confirm(LANG.current==='ar'?'هل أكملت الاختبار بنجاح؟':'Did you pass the quick quiz?');
        if(ok){ updateProgressForUnit(unit.id, 100, 'completed'); alert('Done!') }
        else { updateProgressForUnit(unit.id, 50, 'in_progress'); alert('Progress saved as in_progress') }
      });

      document.getElementById('btnStartExp').addEventListener('click', ()=>{ alert('Open interactive simulation — not implemented in prototype'); });

      document.getElementById('btnRecord').addEventListener('click', ()=>{ alert('Record video functionality would use camera / WebRTC in real app'); });
    }

    function updateProgressForUnit(unitId, percent=0, status='in_progress'){
      const user = AppState.currentUser || JSON.parse(localStorage.getItem('bio_current_user') || 'null');
      if(!user){ alert('Please login'); return; }
      const all = getProgress();
      let p = all.find(pp=>pp.userId===user.id && pp.unitId===unitId);
      if(!p){ p = { id: Date.now(), userId: user.id, unitId, percent, status, lastAccess: new Date().toISOString() }; all.push(p); }
      else { p.percent = percent; p.status = status; p.lastAccess = new Date().toISOString(); }
      saveProgress(all);
    }

    /* ---------------- Page: Library ---------------- */
    function pageLibrary(){
      const courses = getCourses();
      // we'll show glossary & infographics (from courses units)
      let html = `<section class="card"><h2>${t('library')}</h2>
        <div class="row" style="margin-top:12px">
          <div class="col card"><h4>مصطلحات العلوم بلغة الإشارة / Glossary</h4>
            <ul>${courses.flatMap(c=>c.units.map(u=>`<li>${escapeHtml(getLocalized(u,'title'))} — <button class="btn secondary" onclick="alert('Play term video — demo')">${t('playSign')}</button></li>`)).join('')}</ul>
          </div>
          <div class="col card"><h4>بطاقات وسائط / Infographics</h4>
            <p class="muted">عرض أو تحميل إنفوجرافيك مبسّط (demo)</p>
            <button class="btn" onclick="alert('Download infographic (demo)')">${t('download')}</button>
          </div>
        </div>
      </section>`;
      setContent(html);
    }

    /* ---------------- Page: Progress & Reports ---------------- */
    function pageProgress(){
      const user = AppState.currentUser || JSON.parse(localStorage.getItem('bio_current_user') || 'null');
      if(!user){ setContent(`<section class="card"><div class="muted">Please login to see progress</div></section>`); return; }
      const progress = getProgress().filter(p=>p.userId===user.id);
      const courses = getCourses();
      // build summary per course
      const rows = courses.map(c=>{
        const total = c.units.length;
        const completed = c.units.filter(u=>progress.find(p=>p.unitId===u.id && p.status==='completed')).length;
        const percent = Math.round((completed/Math.max(1,total))*100);
        return `<tr><td>${escapeHtml(getLocalized(c,'title'))}</td><td style="text-align:center">${completed}/${total}</td><td style="text-align:center">${percent}%</td></tr>`;
      }).join('');

      let html = `<section class="card"><h2>${t('progress')}</h2>
        <div style="overflow:auto;margin-top:10px">
          <table style="width:100%;border-collapse:collapse">
            <thead><tr><th style="text-align:right">Course</th><th style="text-align:center">Completed</th><th style="text-align:center">Progress</th></tr></thead>
            <tbody>${rows}</tbody>
          </table>
        </div>
        <div style="margin-top:12px">
          <button class="btn" onclick="downloadReport()">تنزيل التقرير / Download report</button>
        </div>
      </section>`;
      setContent(html);
    }

    function downloadReport(){
      const user = AppState.currentUser || JSON.parse(localStorage.getItem('bio_current_user') || 'null');
      const progress = getProgress().filter(p=>p.userId===user.id);
      const courses = getCourses();
      let csv = 'course,unit,status,percent,lastAccess\n';
      progress.forEach(p=>{
        const course = courses.find(c=>c.units.find(u=>u.id===p.unitId));
        const unit = course?.units.find(u=>u.id===p.unitId);
        csv += `"${getLocalized(course,'title')}","${getLocalized(unit,'title')}",${p.status},${p.percent},${p.lastAccess}\n`;
      });
      const blob = new Blob([csv], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'progress_report.csv'; a.click(); URL.revokeObjectURL(url);
    }

    /* ---------------- Page: Support ---------------- */
    function pageSupport(){
      let html = `<section class="card"><h2>${t('support')}</h2>
        <div class="row" style="margin-top:12px">
          <div class="col card">
            <h4>رسالة / Message</h4>
            <textarea id="supportMsg" rows="6" placeholder="اكتب سؤالك أو اطلب جلسة"></textarea>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button class="btn" id="sendSupport">إرسال</button>
              <button class="btn secondary" id="callSign">مكالمة بلغة الإشارة</button>
            </div>
          </div>
          <div class="col card">
            <h4>الأسئلة الشائعة / FAQ</h4>
            <ul>
              <li>كيف أبدأ دورة؟</li>
              <li>كيف أحمل الفيديو للعمل دون اتصال؟</li>
              <li>كيف أتواصل مع مدرس بلغة الإشارة؟</li>
            </ul>
          </div>
        </div>
      </section>`;
      setContent(html);
      el('sendSupport').addEventListener('click', ()=>{
        const msg = el('supportMsg').value.trim();
        if(!msg) { alert('Please write a message'); return; }
        alert('Message sent (demo). Support team will contact you.');
        el('supportMsg').value = '';
      });
      el('callSign').addEventListener('click', ()=>{ alert('WebRTC call with sign language interpreter would start here (demo).'); });
    }

    /* ---------------- Page: Settings ---------------- */
    function pageSettings(){
      const user = AppState.currentUser || JSON.parse(localStorage.getItem('bio_current_user') || 'null');
      const html = `<section class="card"><h2>${t('settings')}</h2>
        <div style="max-width:640px">
          <div class="form-row"><label>Interface language / لغة الواجهة</label>
            <select id="uiLang"><option value="ar">العربية</option><option value="fr">Français</option><option value="en">English</option></select>
          </div>
          <div class="form-row"><label>Display mode / العرض</label>
            <select id="displayMode"><option value="normal">Normal</option><option value="high-contrast">High contrast</option></select>
          </div>
          <div class="form-row"><label>Upload profile pic (demo)</label><input id="uploadPic" type="file" accept="image/*"></div>
          <div style="display:flex;gap:8px;margin-top:10px"><button class="btn" id="saveSettings">Save</button><button class="btn secondary" id="cancelSettings">Cancel</button></div>
        </div>
      </section>`;
      setContent(html);
      el('uiLang').value = LANG.current;
      el('displayMode').value = document.documentElement.style.getPropertyValue('--contrast') ? 'high-contrast' : 'normal';
      el('saveSettings').addEventListener('click', ()=>{
        const newLang = el('uiLang').value; localStorage.setItem('bio_lang', newLang); LANG.current=newLang;
        const mode = el('displayMode').value;
        if(mode==='high-contrast'){ document.body.style.background='#000'; document.body.style.color='#fff' }
        else { document.body.style.background= 'var(--bg)'; document.body.style.color='#111' }
        alert('Saved. Language changed — interface will update.');
        navigateTo('dashboard');
      });
      el('cancelSettings').addEventListener('click', ()=>{ navigateTo('dashboard') });
    }

    /* ---------------- Helpers ---------------- */
    function getLocalized(obj, field){
      if(!obj) return '';
      if(LANG.current==='ar') return obj[field+'_ar'] || obj[field+'_en'] || obj[field];
      if(LANG.current==='fr') return obj[field+'_fr'] || obj[field+'_en'] || obj[field];
      return obj[field+'_en'] || obj[field+'_fr'] || obj[field+'_ar'] || obj[field];
    }

    function escapeHtml(str){ if(!str) return ''; return String(str).replace(/[&<>"']/g, function(m){ return({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]) }); }

    /* ---------------- Initialisation ---------------- */
    function init(){
      loadData();
      // language select
      el('langSelect').value = LANG.current;
      el('langSelect').addEventListener('change', (e)=>{ LANG.current = e.target.value; localStorage.setItem('bio_lang', LANG.current); updateStaticTexts(); navigateTo(AppState.currentPage || 'dashboard') });
      // contrast toggle
      el('toggleContrast').addEventListener('click', ()=>{
        const pressed = el('toggleContrast').getAttribute('aria-pressed') === 'true';
        el('toggleContrast').setAttribute('aria-pressed', String(!pressed));
        if(!pressed){ document.documentElement.style.setProperty('--accent','#0a4f7a'); document.documentElement.style.setProperty('--primary','#1b6b3a'); }
        else { document.documentElement.style.removeProperty('--accent'); document.documentElement.style.removeProperty('--primary'); }
      });

      // load current user if exists
      const cur = JSON.parse(localStorage.getItem('bio_current_user')||'null');
      if(cur){ AppState.currentUser = cur; renderTopUser(); navigateTo('dashboard'); }
      else { navigateTo('login'); renderTopUser(); }
    }

    function updateStaticTexts(){
      // brand title and nav label translations
      el('brandTitle').innerText = 'BioHands';
      if(LANG.current==='ar'){ el('brandSlogan').innerText = 'العلم بلغة يفهمها الجميع'; el('navTitle').innerText='القائمة'; el('footerText').innerText='© 2025 BioHands — نحو تعليم شامل وعادل للجميع.'; document.documentElement.dir='rtl'; }
      else if(LANG.current==='fr'){ el('brandSlogan').innerText = 'La science à portée de main'; el('navTitle').innerText='Menu'; el('footerText').innerText='© 2025 BioHands — Inclusion et Éducation.'; document.documentElement.dir='ltr'; }
      else { el('brandSlogan').innerText = 'Science in every hand'; el('navTitle').innerText='Menu'; el('footerText').innerText='© 2025 BioHands — Inclusion × Education.'; document.documentElement.dir='ltr'; }

      // update menu button texts (simple)
      document.querySelectorAll('#menuList .item').forEach(b=>{
        const p = b.dataset.page;
        if(p==='dashboard') b.querySelector('.right').innerText = (LANG.current==='ar'?'لوحة التحكم': LANG.current==='fr'?'Tableau de bord':'Dashboard');
        if(p==='courses') b.querySelector('.right').innerText = (LANG.current==='ar'?'الدورات': LANG.current==='fr'?'Cours':'Courses');
        if(p==='library') b.querySelector('.right').innerText = (LANG.current==='ar'?'المكتبة': LANG.current==='fr'?'Bibliothèque':'Library');
        if(p==='progress') b.querySelector('.right').innerText = (LANG.current==='ar'?'التقارير والتقدّم': LANG.current==='fr'?'Rapports':'Progress');
        if(p==='support') b.querySelector('.right').innerText = (LANG.current==='ar'?'الدعم': LANG.current==='fr'?'Support':'Support');
        if(p==='settings') b.querySelector('.right').innerText = (LANG.current==='ar'?'الإعدادات': LANG.current==='fr'?'Paramètres':'Settings');
        if(p==='logout') b.querySelector('.right').innerText = (LANG.current==='ar'?'تسجيل الخروج': LANG.current==='fr'?'Se déconnecter':'Logout');
      });
      renderTopUser();
    }

    // init
    init();

    // Expose some functions for inline onclick handlers
    window.navigateTo = navigateTo;
    window.escapeHtml = escapeHtml;

  </script>
</body>
</html>
